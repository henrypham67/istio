grafana:
  adminPassword: admin
  sidecar:
    datasources:
      name: Mimir
      uid: mimir
      url: http://mimir-nginx.monitoring.svc.cluster.local/prometheus
    dashboards:
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      # Allow discovery in all namespaces for dashboards
      searchNamespace: ALL

  additionalDataSources:
    - uid: tempo
      orgId: 1
      name: Tempo
      type: tempo
      typeName: Tempo
      access: proxy
      url: http://tempo.monitoring.svc.cluster.local:3100
      password: ''
      user: ''
      database: ''
      basicAuth: false
      isDefault: false
      jsonData:
        nodeGraph:
          enabled: true
        tracesToLogsV2:
          customQuery: false
          datasourceUid: loki
          filterBySpanID: false
          filterByTraceID: true
          tags:
            - key: service.name
              value: compose_service
      readOnly: false
      editable: true
    - uid: loki
      orgId: 1
      name: Loki
      type: loki
      typeName: Loki
      access: proxy
      url: http://loki-gateway.logging.svc.cluster.local
      password: ''
      user: ''
      database: ''
      basicAuth: false
      isDefault: false
      jsonData:
        derivedFields:
          - datasourceUid: tempo
            matcherRegex: (?:trace_id)=(\w+)
            matcherType: regex
            name: TraceID
            url: $${__value.raw}
      readOnly: false
      editable: true

prometheus:
  ## Toggle prometheus into agent mode
  ## Note many of features described below (e.g. rules, query, alerting, remote read, thanos) will not work in agent mode.
  ## ref: https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/platform/prometheus-agent.md
  ## Alert rules evaluation -> Mimir
  ## 
  agentMode: true
  prometheusSpec:
    # these config make other targets disappear
    ruleNamespaceSelector: {}
    serviceMonitorNamespaceSelector: {}
    podMonitorNamespaceSelector: {}
    remoteWriteDashboards: true
    remoteWrite:
      - name: mimir
        url: http://mimir-nginx.monitoring.svc.cluster.local/api/v1/push
        remoteTimeout: 30s
        headers:
          X-Scope-OrgID: in-cluster
          
alertmanager:
  enabled: false